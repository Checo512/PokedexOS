<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>RotomDex OS v1.0</title>
    <link rel="icon" type="image/png" href="https://www.pokewiki.de/images/archive/9/91/20221120171746%21Smart-Rotom_Artwork_KAPU.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        :root {
            /* Colores */
            --rotom-red: #ff3b3b;
            --bezel-gray: #151515;
            --neon-blue: #00f3ff;
            --neon-orange: #ff9d00;
            --glass-bg: rgba(10, 20, 30, 0.85);
            --font-main: 'Rajdhani', sans-serif;
            --font-mono: 'Share Tech Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; scrollbar-width: none; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { display: none; }

        body {
            background-color: #050505;
            color: white;
            font-family: var(--font-main);
            height: 100vh;
            height: 100dvh; 
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#222 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* --- CARCASA ROTOM (RESPONSIVE) --- */
        .rotom-chassis {
            position: relative;
            width: 96vw; height: 96vh;
            max-width: 1800px;
            background-color: var(--rotom-red);
            border-radius: 30px;
            box-shadow: 
                inset 5px 5px 15px rgba(255,255,255,0.3),
                inset -5px -5px 20px rgba(0,0,0,0.5),
                0 0 60px rgba(255, 59, 59, 0.2);
            padding: 15px;
            display: flex; flex-direction: column;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .screen-bezel {
            width: 100%; height: 100%;
            background: var(--bezel-gray);
            border-radius: 20px;
            padding: 10px;
            box-shadow: inset 0 0 20px black;
            position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }
        
        .rotom-camera {
            position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
            width: 10px; height: 10px; background: #000; border-radius: 50%;
            border: 1px solid #444; z-index: 60;
            box-shadow: 0 0 5px rgba(0,243,255,0.8);
        }

        /* --- PANTALLA DIGITAL --- */
        .screen-display {
            width: 100%; height: 100%;
            background: radial-gradient(circle at center, #111a26 0%, #000 100%);
            border-radius: 12px;
            position: relative; overflow: hidden;
            border: 1px solid #333;
            display: flex; flex-direction: column;
        }

        .screen-display::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 5; opacity: 0.5;
        }

        /* --- UI HEADER --- */
        .ui-header {
            height: 70px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--neon-blue);
            padding: 0 20px; position: relative; z-index: 50; 
        }

        .search-bar-container {
            position: relative; width: 50%; min-width: 300px;
            background: rgba(0, 20, 40, 0.9);
            border: 1px solid var(--neon-blue);
            border-radius: 30px; display: flex; align-items: center;
            padding: 8px 20px;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            transition: box-shadow 0.3s;
        }
        .search-bar-container:focus-within { box-shadow: 0 0 25px rgba(0, 243, 255, 0.4); }

        .search-input {
            flex-grow: 1; background: transparent; border: none;
            color: white; font-family: var(--font-main); font-size: 1.3rem;
            font-weight: 600; text-transform: uppercase; letter-spacing: 1px; outline: none;
            text-align: center; 
        }
        .search-input::placeholder { color: rgba(0, 243, 255, 0.4); }
        .search-icon { color: var(--neon-blue); font-size: 1.2rem; cursor: pointer; position: absolute; right: 20px; }

        /* --- IDLE SCREEN --- */
        .idle-screen {
            position: absolute; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10;
            background: rgba(0,0,0,0.4); transition: opacity 0.5s;
        }
        .idle-screen.hidden { opacity: 0; pointer-events: none; }
        .rotom-face { font-size: 8rem; color: var(--neon-blue); animation: bounce 3s infinite ease-in-out; filter: drop-shadow(0 0 20px var(--neon-blue)); }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* --- OVERLAYS (LOADING, GLITCH, ERROR) --- */
        .overlay {
            position: absolute; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; transition: opacity 0.2s; opacity: 0; pointer-events: none;
            overflow: hidden;
        }
        .overlay.active { opacity: 1; pointer-events: all; }

        #loading-overlay { background: #050505; }
        .tv-noise {
            position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background-image: repeating-radial-gradient(#000 0 0.0001%, #1a1a1a 0 0.0002%);
            background-size: 10px 10px;
            animation: noiseAnim 0.5s infinite linear; opacity: 0.04; pointer-events: none;
        }
        @keyframes noiseAnim { 0% { transform: translate(0, 0); } 100% { transform: translate(10px, 10px); } }
        .antenna-icon { font-size: 5rem; color: var(--neon-orange); margin-bottom: 20px; filter: drop-shadow(0 0 15px var(--neon-orange)); position: relative; z-index: 2; animation: floatAntenna 3s ease-in-out infinite; }
        @keyframes floatAntenna { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .glitch-wrapper { position: relative; }
        .glitch-text { font-family: var(--font-mono); font-size: 2.5rem; font-weight: bold; color: white; letter-spacing: 4px; position: relative; z-index: 1; }
        .glitch-text::before, .glitch-text::after { content: attr(data-text); position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: #050505; opacity: 0.8; }
        .glitch-text::before { left: 2px; text-shadow: -1px 0 #ff00c1; clip-path: inset(0 0 0 0); animation: soft-glitch-1 4s infinite linear; }
        .glitch-text::after { left: -2px; text-shadow: -1px 0 #00fff9; clip-path: inset(0 0 0 0); animation: soft-glitch-2 4s infinite linear; }
        @keyframes soft-glitch-1 { 0%,92%{clip-path:inset(0 0 0 0);transform:translate(0)} 93%{clip-path:inset(20% 0 80% 0);transform:translate(-2px,2px)} 94%{clip-path:inset(80% 0 10% 0);transform:translate(2px,-2px)} 95%,100%{clip-path:inset(0 0 0 0);transform:translate(0)} }
        @keyframes soft-glitch-2 { 0%,94%{clip-path:inset(0 0 0 0);transform:translate(0)} 95%{clip-path:inset(10% 0 60% 0);transform:translate(2px,2px)} 96%{clip-path:inset(70% 0 20% 0);transform:translate(-2px,-2px)} 97%,100%{clip-path:inset(0 0 0 0);transform:translate(0)} }

        #response-glitch-overlay { background: #000; animation: screen-glitch 0.4s ease-out both; }
        @keyframes screen-glitch { 0% { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); opacity: 1; } 20% { clip-path: polygon(0 15%, 100% 15%, 100% 20%, 0 20%); } 40% { clip-path: polygon(0 80%, 100% 80%, 100% 82%, 0 82%); } 60% { clip-path: polygon(0 45%, 100% 45%, 100% 55%, 0 55%); } 100% { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); opacity: 0; } }

        #error-overlay { background: rgba(5, 5, 5, 0.9); }
        .error-card { background: rgba(20, 10, 10, 0.8); border: 2px solid var(--rotom-red); border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 0 50px rgba(255, 59, 59, 0.2); width: 600px; max-width: 90%; }
        .error-title { font-size: 2.5rem; text-transform: uppercase; font-weight: 800; color: var(--rotom-red); margin-bottom: 10px; }
        .error-message { font-size: 1.2rem; line-height: 1.6; color: #ddd; margin-bottom: 30px; }
        .error-btn { background: transparent; border: 2px solid var(--rotom-red); color: var(--rotom-red); padding: 12px 40px; cursor: pointer; font-weight: bold; font-family: var(--font-main); text-transform: uppercase; font-size: 1rem; border-radius: 8px; transition: all 0.3s; }
        .error-btn:hover { background: var(--rotom-red); color: black; box-shadow: 0 0 20px rgba(255, 59, 59, 0.5); }
        
        /* --- MAIN STAGE (DESKTOP) --- */
        .main-stage { flex-grow: 1; display: none; padding: 20px 40px; gap: 30px; z-index: 5; opacity: 0; transition: all 0.5s ease; position: relative; height: calc(100% - 70px); box-sizing: border-box; }
        .main-stage.has-drawer { padding-bottom: 200px; }
        .main-stage.active { display: flex; opacity: 1; }

        /* PANEL IZQUIERDO: VISUAL */
        .panel-visual { flex: 1; display: flex; flex-direction: column; background: rgba(255,255,255,0.02); border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); padding: 20px; position: relative; overflow-y: auto; height: 100%; }
        .pk-hologram { min-height: 250px; flex-grow: 1; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 20px; }
        .pk-hologram::after { content: ''; position: absolute; bottom: 30px; width: 60%; height: 40px; background: radial-gradient(ellipse, var(--neon-blue) 0%, transparent 70%); opacity: 0.15; transform: rotateX(60deg); }
        .pk-sprite { max-height: 90%; max-width: 90%; z-index: 2; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); animation: floatPk 5s ease-in-out infinite; }
        @keyframes floatPk { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }

        .sprite-glitching { animation: static-glitch 0.4s ease-out both; }
        @keyframes static-glitch { 0% { clip-path: inset(0 0 0 0); } 10% { clip-path: inset(85% 0 10% 0); } 20% { clip-path: inset(15% 0 70% 0); } 30% { clip-path: inset(75% 0 5% 0); } 40% { clip-path: inset(30% 0 45% 0); } 50% { opacity: 0.5; clip-path: inset(50% 0 50% 0); } 60% { opacity: 1; clip-path: inset(30% 0 45% 0); } 70% { clip-path: inset(75% 0 5% 0); } 80% { clip-path: inset(15% 0 70% 0); } 90% { clip-path: inset(85% 0 10% 0); } 100% { clip-path: inset(0 0 0 0); } }

        .shiny-toggle-btn { position: absolute; top: 15px; right: 15px; z-index: 10; background: rgba(0, 243, 255, 0.1); border: 1px solid var(--neon-blue); color: var(--neon-blue); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
        .shiny-toggle-btn:hover { background: rgba(0, 243, 255, 0.3); transform: scale(1.1); }
        .shiny-toggle-btn.active { background: var(--neon-orange); color: white; border-color: var(--neon-orange); box-shadow: 0 0 15px rgba(255, 157, 0, 0.5); text-shadow: 0 0 10px white; }

        .pk-bio { text-align: center; padding-bottom: 20px; }
        .pk-id { font-family: var(--font-mono); color: #666; font-size: 1.5rem; display: block; }
        .pk-name { font-size: 3.5rem; font-weight: 800; text-transform: uppercase; color: white; line-height: 1; margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,255,255,0.1); }
        .pk-desc-box { background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; border-left: 3px solid var(--neon-orange); color: #ccc; font-size: 1.1rem; line-height: 1.5; text-align: left; margin-top: 15px; }
        /* ===== NUEVO: Estilo para la Fila de Metadatos ===== */
        .pk-meta-row { font-family: var(--font-mono); color: var(--neon-blue); margin-bottom: 10px; text-transform: capitalize; }

        /* PANEL DERECHO: DATOS */
        .panel-data { flex: 1; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; height: 100%; }
        .data-card { background: var(--glass-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; overflow: hidden; flex-shrink: 0; }
        .card-header { font-family: var(--font-mono); color: var(--neon-blue); font-size: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 15px; padding-bottom: 5px; display: flex; justify-content: space-between; }

        /* STATS */
        .stat-grid { display: grid; gap: 8px; }
        .stat-line { display: grid; grid-template-columns: 40px 1fr 35px; align-items: center; gap: 15px; }
        .stat-label { font-weight: 700; color: #888; font-size: 0.9rem; }
        .stat-bar-bg { height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 5px; transition: width 1s ease-out; }
        .stat-val { font-family: var(--font-mono); text-align: right; color: white; }

        /* MOVES LIST */
        .moves-grid { display: grid; grid-template-columns: 1fr; gap: 8px; max-height: 350px; overflow-y: auto; padding-right: 5px; }
        .move-row { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 12px 15px; border-radius: 8px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; }
        .move-row:hover { background: rgba(0, 243, 255, 0.1); border-color: var(--neon-blue); transform: translateX(5px); }
        .move-name { font-weight: 700; font-size: 1.1rem; }
        .move-type { font-size: 0.8rem; font-weight: bold; text-transform: uppercase; padding: 3px 8px; border-radius: 4px; color: white; text-shadow: 1px 1px 0 rgba(0,0,0,0.5); }

        /* --- GENERIC STAGE --- */
        .generic-stage { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; padding: 20px; z-index: 5; opacity: 0; transition: opacity 0.5s; }
        .generic-stage.has-drawer { padding-bottom: 200px; }
        .generic-stage.active { display: flex; opacity: 1; }
        .info-card { width: 800px; max-width: 90%; background: rgba(10, 15, 20, 0.95); border: 2px solid var(--neon-orange); border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 0 50px rgba(255, 94, 0, 0.15); }
        .ic-title { font-size: 3.5rem; text-transform: uppercase; font-weight: 800; color: white; margin-bottom: 10px; }
        .ic-meta { font-family: var(--font-mono); color: var(--neon-blue); font-size: 1.2rem; text-transform: uppercase; margin-bottom: 30px; }
        .ic-body { font-size: 1.3rem; line-height: 1.6; color: #ddd; background: rgba(255,255,255,0.05); padding: 25px; border-radius: 12px; margin-bottom: 30px; }
        .ic-data-row { display: flex; justify-content: center; gap: 40px; }
        .ic-data-point { text-align: center; }
        .ic-lbl { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        .ic-val { font-size: 1.8rem; font-weight: bold; color: var(--neon-blue); }

        /* --- DRAWER (RESULTADOS) --- */
        .drawer { position: absolute; bottom: 0; left: 0; width: 100%; height: 180px; background: #080808; border-top: 2px solid var(--neon-blue); transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); z-index: 60; display: grid; grid-template-columns: 50px 1fr 50px; grid-template-rows: 30px 1fr; grid-template-areas: "header header header" "left content right"; }
        .drawer.visible { transform: translateY(0); }
        .drawer-header { grid-area: header; background: var(--neon-blue); color: black; font-weight: bold; text-align: center; font-size: 0.8rem; padding-top: 5px; letter-spacing: 2px; }
        .drawer-content { grid-area: content; display: flex; align-items: center; overflow-x: auto; padding: 10px 0; -webkit-overflow-scrolling: touch; cursor: grab; }
        .drawer-content:active { cursor: grabbing; }
        .drawer-items-wrapper { display: flex; gap: 20px; margin-left: auto; margin-right: auto; padding: 0 20px; }
        .drawer-scroll-btn { grid-row: 2; background: rgba(0, 243, 255, 0.1); border: none; color: var(--neon-blue); font-size: 1.5rem; cursor: pointer; transition: all 0.3s; z-index: 5; display: flex; align-items: center; justify-content: center; }
        .drawer-scroll-btn:hover { background: rgba(0, 243, 255, 0.3); }
        .drawer-scroll-btn.hidden { opacity: 0; pointer-events: none; }
        #scroll-left-btn { grid-column: 1; }
        #scroll-right-btn { grid-column: 3; }
        .mini-card { width: 100px; height: 120px; flex-shrink: 0; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; transition: all 0.2s; }
        .mini-card:hover { transform: translateY(-10px) scale(1.05); background: rgba(255,255,255,0.15); border-color: white; z-index: 10; }
        .mini-card.active { border-color: var(--neon-orange); box-shadow: 0 0 15px rgba(255, 157, 0, 0.4); }
        .mini-rank { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--neon-orange); color: white; font-weight: bold; font-size: 0.8rem; padding: 2px 8px; border-radius: 10px; font-family: var(--font-mono); box-shadow: 0 2px 5px rgba(0,0,0,0.5); z-index: 2; }
        .mini-img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 8px; }
        .mini-label { font-size: 0.75rem; text-align: center; width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- MEDIA QUERIES (ADAPTACIÓN MÓVIL) --- */
        @media (max-width: 768px) {
            .rotom-chassis { width: 100%; height: 100%; border-radius: 0; padding: 0; box-shadow: none; }
            .screen-bezel { border-radius: 0; padding: 0; box-shadow: none; }
            .screen-display { border-radius: 0; border: none; }
            .rotom-camera { top: 5px; width: 8px; height: 8px; }
            .ui-header { height: 60px; padding: 0 10px; }
            .search-bar-container { width: 90%; min-width: auto; padding: 5px 15px; }
            .search-input { font-size: 1rem; }
            
            /* Main Stage */
            .main-stage { flex-direction: column; padding: 10px 10px 80px 10px; overflow-y: auto; display: block; }
            .main-stage.has-drawer { padding-bottom: 260px !important; }
            
            .panel-visual { flex: none; width: 100%; height: auto; min-height: auto; margin-bottom: 15px; padding: 15px; overflow: visible; }
            .pk-hologram { min-height: 180px; }
            .pk-name { font-size: 2.5rem; }
            .panel-data { flex: none; width: 100%; height: auto; overflow: visible; }
            .stat-line { gap: 10px; font-size: 0.8rem; }
            .moves-grid { max-height: none; }
            
            /* --- SOLUCIÓN NUCLEAR (Posicionamiento Absoluto) --- */
            /* Esto desvincula la tarjeta del flujo flexbox y la fuerza arriba */
            .generic-stage { 
                display: none;
                /* Propiedades para romper el centrado */
                position: absolute !important;
                top: 70px !important; /* Justo debajo del header */
                left: 0 !important;
                width: 100% !important;
                height: calc(100% - 70px) !important;
                background: #050505; /* Fondo solido para tapar lo de atras */
                z-index: 50 !important; /* Encima de todo */
                overflow-y: auto !important; /* Scroll interno */
                padding: 0 !important;
                /* Anular flexbox por completo */
                flex-direction: column !important;
                justify-content: flex-start !important;
                align-items: center !important;
            }
            
            .generic-stage.active { 
                display: block !important; 
            }
            
            /* Ajuste de la tarjeta interna */
            .info-card { 
                display: block !important;
                width: 90% !important;
                max-width: none !important;
                /* Margen superior para separarlo del header, inferior para scroll */
                margin: 20px auto 150px auto !important; 
                height: auto !important;
                position: relative !important;
                transform: none !important; /* Quitar cualquier transformacion de centrado */
            }

            .ic-title { font-size: 2rem; }
            .ic-data-row { flex-direction: column; gap: 15px; }
            /* ---------------------------------- */

            .drawer { display: flex; flex-direction: column; }
            .drawer-scroll-btn { display: none; }
            .drawer-content { justify-content: flex-start; }
            .drawer-items-wrapper { margin: 0; }
            .rotom-face { font-size: 5rem; }
            .antenna-icon { font-size: 4rem; }
            .glitch-text { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <div class="rotom-chassis">
        <div class="screen-bezel">
            <div class="rotom-camera"></div>
            
            <div class="screen-display">
                
                <!-- Header -->
                <div class="ui-header">
                    <div class="search-bar-container">
                        <input type="text" id="search-input" class="search-input" placeholder="BUSCAR POKÉMON...">
                        <i class="fas fa-search search-icon" id="btn-search"></i>
                    </div>
                </div>

                <!-- Overlays -->
                <div id="response-glitch-overlay" class="overlay"></div>
                <div id="error-overlay" class="overlay">
                    <div class="error-card">
                        <h2 id="error-title" class="error-title">ERROR</h2>
                        <p id="error-message" class="error-message">Mensaje de error.</p>
                        <button id="error-btn" class="error-btn">ENTENDIDO</button>
                    </div>
                </div>
                <div id="loading-overlay" class="overlay">
                    <div class="tv-noise"></div>
                    <i class="fas fa-satellite-dish antenna-icon"></i>
                    <div class="glitch-wrapper">
                        <div class="glitch-text" data-text="BUSCANDO DATOS...">BUSCANDO DATOS...</div>
                    </div>
                </div>

                <!-- Idle -->
                <div id="idle-screen" class="idle-screen">
                    <i class="fas fa-bolt rotom-face"></i>
                    <p style="color:#aaa; margin-top:30px; letter-spacing:3px; font-family:var(--font-mono);">SISTEMA EN ESPERA</p>
                </div>

                <!-- Main Stage -->
                <div id="pokemon-stage" class="main-stage">
                    <div class="panel-visual">
                        <div class="pk-hologram">
                            <img id="main-sprite" src="" class="pk-sprite">
                            <button id="shiny-toggle" class="shiny-toggle-btn"><i class="fas fa-star"></i></button>
                        </div>
                        <div class="pk-bio">
                            <span id="main-id" class="pk-id">#000</span>
                            <div id="main-name" class="pk-name">---</div>
                            <div id="type-container" class="pk-meta-row" style="display:flex; gap:10px; justify-content:center; margin-bottom:15px;"></div>
                            <div class="pk-meta-row">
                                <span id="main-h" style="margin-right:20px;">ALT: --m</span>
                                <span id="main-w">PESO: --kg</span>
                            </div>
                            <!-- ===== NUEVO: Contenedores para Grupo Huevo y Género ===== -->
                            <div id="main-gender-ratio" class="pk-meta-row"></div>
                            <div id="main-egg-groups" class="pk-meta-row"></div>
                            <div id="main-desc" class="pk-desc-box">---</div>
                        </div>
                    </div>

                    <div class="panel-data">
                        <div class="data-card">
                            <div class="card-header"><span>ESTADÍSTICAS</span> <i class="fas fa-chart-bar"></i></div>
                            <div id="stats-container" class="stat-grid"></div>
                        </div>
                        <div class="data-card" style="margin-top:15px; display:flex; flex-direction:column;">
                            <div class="card-header"><span>MOVIMIENTOS</span> <i class="fas fa-list-ul"></i></div>
                            <div id="moves-container" class="moves-grid"></div>
                        </div>
                    </div>
                </div>

                <!-- Generic Stage -->
                <div id="generic-stage" class="generic-stage">
                    <div class="info-card" id="generic-content"></div>
                </div>

                <!-- Drawer -->
                <div id="results-drawer" class="drawer">
                    <div class="drawer-header" id="drawer-count">RESULTADOS ADICIONALES</div>
                    <button id="scroll-left-btn" class="drawer-scroll-btn hidden"><i class="fas fa-chevron-left"></i></button>
                    <div class="drawer-content" id="drawer-grid">
                        <div class="drawer-items-wrapper" id="drawer-items-wrapper"></div>
                    </div>
                    <button id="scroll-right-btn" class="drawer-scroll-btn hidden"><i class="fas fa-chevron-right"></i></button>
                </div>

            </div>
        </div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwivIdb0VeUE0RyyclqJWC7BX3BmZkvvd0z05zJvKSZj-VLuvFN6r9d4-i_trij2EvA/exec';
        
        let db = { pokemon: null, habilidades: null, movimientos: null, items: null };
        let currentResults = [];
        let currentPokemon = null;
        let showingShiny = false;
        let isAnimatingShiny = false;

        const typeColors = {
            normal: '#A8A77A', fire: '#EE8130', water: '#6390F0', electric: '#F7D02C',
            grass: '#7AC74C', ice: '#96D9D6', fighting: '#C22E28', poison: '#A33EA1',
            ground: '#E2BF65', flying: '#A98FF3', psychic: '#F95587', bug: '#A6B91A',
            rock: '#B6A136', ghost: '#735797', dragon: '#6F35FC', dark: '#705746',
            steel: '#B7B7CE', fairy: '#D685AD'
        };
        const statColors = { ps:'#FF5959', ataque:'#F5AC78', defensa:'#FAE078', ataque_especial:'#9DB7F5', defensa_especial:'#A7DB8D', velocidad:'#FA92B2' };

        document.addEventListener('DOMContentLoaded', () => {
            loadDB();
            const inp = document.getElementById('search-input');
            const btn = document.getElementById('btn-search');
            inp.addEventListener('keyup', e => { if(e.key==='Enter') runSearch(); });
            btn.addEventListener('click', runSearch);

            document.getElementById('shiny-toggle').addEventListener('click', toggleShiny);
            document.getElementById('error-btn').addEventListener('click', hideError);
            setupDrawerScrolling();
        });

        function setupDrawerScrolling() {
            const slider = document.getElementById('drawer-grid');
            const leftBtn = document.getElementById('scroll-left-btn');
            const rightBtn = document.getElementById('scroll-right-btn');
            let isDown = false;
            let startX;
            let scrollLeft;

            slider.addEventListener('mousedown', (e) => { isDown = true; startX = e.pageX - slider.offsetLeft; scrollLeft = slider.scrollLeft; });
            slider.addEventListener('mouseleave', () => { isDown = false; });
            slider.addEventListener('mouseup', () => { isDown = false; });
            slider.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - slider.offsetLeft;
                const walk = (x - startX) * 2;
                slider.scrollLeft = scrollLeft - walk;
            });
            leftBtn.addEventListener('click', () => { slider.scrollBy({ left: -300, behavior: 'smooth' }); });
            rightBtn.addEventListener('click', () => { slider.scrollBy({ left: 300, behavior: 'smooth' }); });
        }

        async function loadDB() {
            try { 
                await Promise.all(['pokemon', 'habilidades', 'movimientos', 'items'].map(async f => {
                    const r = await fetch(`${f}.json`); 
                    const keyName = f.replace('-completo', '');
                    db[keyName] = await r.json();
                })); 
            } catch(e){ console.error("Error cargando las bases de datos:", e); }
        }

        async function runSearch() {
            const val = document.getElementById('search-input').value.trim();
            if(!val) return;
            if(!db.pokemon || !db.items) await loadDB();

            document.getElementById('loading-overlay').classList.add('active');
            document.getElementById('idle-screen').classList.add('hidden');
            
            document.getElementById('results-drawer').classList.remove('visible');
            document.getElementById('pokemon-stage').classList.remove('has-drawer', 'active');
            document.getElementById('generic-stage').classList.remove('has-drawer', 'active');

            const s = document.createElement('script');
            const cb = 'rotom_'+Date.now();
            window[cb] = (r) => { handleRes(r); delete window[cb]; document.body.removeChild(s); };
            s.src = `${APPS_SCRIPT_URL}?query=${encodeURIComponent(val)}&callback=${cb}`;
            s.onerror = () => {
                document.getElementById('loading-overlay').classList.remove('active');
                showError('ERROR DE CONEXIÓN', 'No se pudo contactar con los servidores de RotomDex. Revisa tu conexión a internet.');
            };
            document.body.appendChild(s);
        }

        function handleRes(raw) {
            const loadingOverlay = document.getElementById('loading-overlay');
            const glitchOverlay = document.getElementById('response-glitch-overlay');
            loadingOverlay.classList.remove('active');
            glitchOverlay.classList.add('active');

            setTimeout(() => {
                glitchOverlay.classList.remove('active');
                
                let data = null;
                try {
                    let str = "";
                    if (typeof raw === 'object' && raw.choices) str = raw.choices[0].message.content;
                    else if (typeof raw === 'string') { try { str = JSON.parse(raw).choices[0].message.content } catch { str = raw } }
                    else str = JSON.stringify(raw);
                    const match = str.match(/\{[\s\S]*"target"[\s\S]*\}/) || str.match(/\{[\s\S]*\}/);
                    if (match) data = JSON.parse(match[0]); else throw new Error();
                } catch (e) { showError('ERROR DE INTERPRETACIÓN', 'La IA ha devuelto una respuesta en un formato no válido o corrupto.'); return; }

                if (data.error) { showError('ERROR DE IA', data.error); return; }

                const res = applyFilters(data);
                currentResults = res;

                if (res.length === 0) { showError('BÚSQUEDA SIN ÉXITO', 'No se encontraron resultados que coincidan con los criterios de tu consulta.'); return; }

                if (res.length > 1) updateDrawer(res, data.target);
                else document.getElementById('results-drawer').classList.remove('visible');

                if (data.target === 'pokemon') showPokemonMode(res);
                else showGenericView(res[0], data.target);
            }, 400);
        }
        
        function showPokemonMode(res) {
            document.getElementById('generic-stage').classList.remove('active');
            const stg = document.getElementById('pokemon-stage');
            stg.classList.add('active');
            if(res.length > 1) stg.classList.add('has-drawer');
            else stg.classList.remove('has-drawer');
            renderMain(res[0]);
        }

        function showGenericView(item, type) {
            document.getElementById('pokemon-stage').classList.remove('active');
            const stg = document.getElementById('generic-stage');
            stg.classList.add('active');
            if(currentResults.length > 1) stg.classList.add('has-drawer');
            else stg.classList.remove('has-drawer');
            renderGeneric(item, type);
        }

        function renderMain(p) {
            currentPokemon = p;
            showingShiny = false;
            
            document.getElementById('main-sprite').src = currentPokemon.sprites.artwork_oficial;
            document.getElementById('shiny-toggle').classList.remove('active');
            document.getElementById('main-id').textContent = `#${String(p.id).padStart(3,'0')}`;
            document.getElementById('main-name').textContent = p.nombre;
            document.getElementById('main-desc').textContent = p.descripcion_pokedex || "Sin datos.";
            document.getElementById('main-h').textContent = `ALT: ${p.altura_m}m`;
            document.getElementById('main-w').textContent = `PESO: ${p.peso_kg}kg`;
            
            document.getElementById('main-gender-ratio').textContent = `Género: ${formatGenderRatio(p.ratio_genero)}`;
            document.getElementById('main-egg-groups').textContent = `Grupos Huevo: ${p.grupos_huevo.join(', ')}`;

            document.getElementById('type-container').innerHTML = p.tipos.map(t=> `<span style="background:${typeColors[t]||'#555'}; padding:5px 15px; border-radius:4px; font-weight:bold; color:white; text-transform:uppercase; text-shadow:1px 1px 0 rgba(0,0,0,0.5);">${t}</span>`).join('');

            const labs = {ps:'PS',ataque:'ATK',defensa:'DEF',ataque_especial:'SPA',defensa_especial:'SPD',velocidad:'SPE'};
            document.getElementById('stats-container').innerHTML = Object.entries(p.stats_base).map(([k,v])=>`
                <div class="stat-line">
                    <div class="stat-label">${labs[k]}</div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${Math.min((v/200)*100,100)}%; background:${statColors[k]};"></div></div>
                    <div class="stat-val">${v}</div>
                </div>
            `).join('');

            if(p.movimientos_ids && db.movimientos) {
                const moves = p.movimientos_ids.map(id=>db.movimientos.find(m=>m.id===id)).filter(Boolean).slice(0,50);
                document.getElementById('moves-container').innerHTML = moves.map(m=>`
                    <div class="move-row" onclick="openMoveDetails(${m.id})">
                        <span class="move-name">${m.nombre}</span>
                        <span class="move-type" style="background:${typeColors[m.tipo]}">${m.tipo}</span>
                    </div>
                `).join('');
            } else { document.getElementById('moves-container').innerHTML = '<div style="padding:10px;">Sin datos.</div>'; }
        }

        function formatGenderRatio(ratio) {
            switch(ratio) {
                case -1: return 'Sin Género';
                case 0: return '100% Macho';
                case 1: return '87.5% Macho, 12.5% Hembra';
                case 2: return '75% Macho, 25% Hembra';
                case 4: return '50% Macho, 50% Hembra';
                case 6: return '25% Macho, 75% Hembra';
                case 8: return '100% Hembra';
                default: return 'Desconocido';
            }
        }
        
        function toggleShiny() {
            if (!currentPokemon || isAnimatingShiny) return;
            isAnimatingShiny = true;
            showingShiny = !showingShiny;
            const img = document.getElementById('main-sprite');
            const btn = document.getElementById('shiny-toggle');
            
            img.classList.add('sprite-glitching');
            const onAnimationEnd = () => {
                img.classList.remove('sprite-glitching');
                isAnimatingShiny = false;
                img.removeEventListener('animationend', onAnimationEnd);
            };
            img.addEventListener('animationend', onAnimationEnd);
            setTimeout(() => { img.src = showingShiny ? currentPokemon.sprites.artwork_oficial_shiny : currentPokemon.sprites.artwork_oficial; }, 150);
            btn.classList.toggle('active', showingShiny);
        }

        window.openMoveDetails = function(id) {
            const m = db.movimientos.find(x=>x.id===id);
            if(m) showGenericView(m, 'movimientos');
            document.getElementById('results-drawer').classList.remove('visible');
            document.getElementById('pokemon-stage').classList.remove('has-drawer');
        }

        function renderGeneric(item, type) {
            const card = document.getElementById('generic-content');
            let html = '';
            if(type==='movimientos') { html = `<div class="ic-title">${item.nombre}</div><div class="ic-meta" style="color:${typeColors[item.tipo]}">${item.tipo} - MOVIMIENTO</div><div class="ic-body">${item.descripcion||"Sin descripción."}</div><div class="ic-data-row"><div class="ic-data-point"><span class="ic-lbl">POTENCIA</span><span class="ic-val">${item.potencia||'-'}</span></div><div class="ic-data-point"><span class="ic-lbl">PRECISIÓN</span><span class="ic-val">${item.precision||'-'}</span></div><div class="ic-data-point"><span class="ic-lbl">PP</span><span class="ic-val">${item.pp||'-'}</span></div></div>`; } 
            else if (type === 'items') { html = `<div class="ic-title">${item.nombre}</div><div class="ic-meta">${item.categoria} - OBJETO</div><div class="ic-body">${item.descripcion||"Sin descripción."}</div><div class="ic-data-row"><div class="ic-data-point"><span class="ic-lbl">COSTO</span><span class="ic-val">${item.costo > 0 ? item.costo : 'No se puede comprar'}</span></div></div>`; } 
            else { html = `<div class="ic-title">${item.nombre}</div><div class="ic-meta">HABILIDAD</div><div class="ic-body">${item.descripcion}</div><div class="ic-data-point"><span class="ic-lbl">POKÉMON COMPATIBLES</span><span class="ic-val">${item.pokemon_con_habilidad_count}</span></div>`; }
            html += `<button onclick="closeGeneric()" style="margin-top:30px; background:transparent; border:1px solid #666; color:#aaa; padding:10px 30px; cursor:pointer; font-weight:bold;">VOLVER</button>`;
            card.innerHTML = html;
        }

        window.closeGeneric = function() {
            if(currentResults.length>0 && currentResults[0].stats_base) {
                showPokemonMode(currentResults);
                if(currentResults.length > 1) document.getElementById('results-drawer').classList.add('visible');
            } else { 
                document.getElementById('generic-stage').classList.remove('active'); 
                document.getElementById('idle-screen').classList.remove('hidden'); 
            }
        }
        
        function updateDrawer(res, type) {
            const d = document.getElementById('results-drawer');
            const g = document.getElementById('drawer-items-wrapper'); 
            const c = document.getElementById('drawer-count');
            
            d.classList.add('visible');
            c.textContent = `${res.length} RESULTADOS ENCONTRADOS`;
            
            const cardsHtml = res.map((item,i)=>`<div class="mini-card ${i===0?'active':''}" onclick="selectItem(${i}, '${type}')"><div class="mini-rank">#${i+1}</div><img src="${ type === 'pokemon' ? item.sprites.artwork_oficial : type === 'items' ? item.sprite_url : 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png'}" class="mini-img"><div class="mini-label">${item.nombre}</div></div>`).join('');
            g.innerHTML = cardsHtml;
            updateDrawerControls();
        }

        function updateDrawerControls() {
            const slider = document.getElementById('drawer-grid');
            const leftBtn = document.getElementById('scroll-left-btn');
            const rightBtn = document.getElementById('scroll-right-btn');
            setTimeout(() => {
                const isScrollable = slider.scrollWidth > slider.clientWidth;
                leftBtn.classList.toggle('hidden', !isScrollable);
                rightBtn.classList.toggle('hidden', !isScrollable);
            }, 100);
        }

        window.selectItem = function(i, type) {
            document.querySelectorAll('.mini-card').forEach(c=>c.classList.remove('active'));
            document.querySelectorAll('.mini-card')[i].classList.add('active');
            if(type==='pokemon') { renderMain(currentResults[i]); document.getElementById('pokemon-stage').classList.add('active'); document.getElementById('generic-stage').classList.remove('active'); }
            else showGenericView(currentResults[i], type);
        }

        function applyFilters(ins) {
    if (!db[ins.target]) return [];
    let r = [...db[ins.target]];
    if (ins.filters) {
        const filters = JSON.parse(JSON.stringify(ins.filters));
        for (const filter of filters) {
            if (filter.field === 'habilidad_nombre') { const h = db.habilidades.find(h => h.nombre === filter.value); if(h){ filter.field = 'habilidades_ids'; filter.value = h.id; }}
            if (filter.field === 'movimiento_nombre') { const m = db.movimientos.find(m => m.nombre === filter.value); if(m){ filter.field = 'movimientos_ids'; filter.value = m.id; }}
            if (filter.field === 'pokemon_nombre') { const p = db.pokemon.find(p => p.nombre === filter.value); if(p){ filter.field = 'id'; filter.value = p.movimientos_ids; filter.operator = 'is_in'; }}
        }
        r = r.filter(i => { return filters.every(f => {
            const val = f.field.split('.').reduce((o,x)=>o?.[x],i);
            if (val === undefined) return false;
            let d=val,v=f.value; if(typeof d==='string')d=d.toLowerCase(); if(typeof v==='string')v=v.toLowerCase();
            switch (f.operator) {
                case 'includes': return Array.isArray(d)?d.some(x=>String(x).toLowerCase().includes(v)):String(d).includes(v);
                case 'not_includes': return Array.isArray(d)?!d.some(x=>String(x).toLowerCase().includes(v)):!String(d).includes(v);
                case 'equals':case'=': return Array.isArray(d)?d.includes(v):d==v;
                case 'greater_than':case'gt': return Number(d)>Number(v);
                case 'less_than':case'lt': return Number(d)<Number(v);
                case 'is_in': return Array.isArray(v) && v.includes(d);
                // --> NUEVO: Lógica para el operador "starts_with"
                case 'starts_with': return String(d).startsWith(v);
                default: return true;
            }
        }); });
    }
    if (ins.sortBy) { r.sort((a,b)=>{const va=ins.sortBy.field.split('.').reduce((o,x)=>o?.[x],a)||0,vb=ins.sortBy.field.split('.').reduce((o,x)=>o?.[x],b)||0;return ins.sortBy.direction==='desc'?(Number(vb)-Number(va)):(Number(va)-Number(vb));}); } 
    else if (ins.limit && r.length > 1) { r.sort(() => Math.random() - 0.5); }
    return ins.limit ? r.slice(0, ins.limit) : r;
}

        function showError(title, message) {
            document.getElementById('error-title').textContent = title;
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-overlay').classList.add('active');
        }

        function hideError() {
            document.getElementById('error-overlay').classList.remove('active');
            document.getElementById('idle-screen').classList.remove('hidden');
        }
    </script>
</body>
</html>